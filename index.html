<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relat√≥rios Zara Home</title>
    <!-- ‚úÖ Porteiro de seguran√ßa carregado -->
    <script src="auth-guard.js" defer></script>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext x='50%' y='85%' style='font-size: 80px; text-anchor: middle;'%3EüìÑ%3C/text%3E%3C/svg%3E">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-stone-50 text-gray-800 flex items-center justify-center min-h-screen">

<!-- ‚úÖ CORRE√á√ÉO: Envolvemos todo o conte√∫do vis√≠vel neste div. -->
<!-- O script auth-guard.js vai procurar por este ID. -->


<div class="absolute top-4 right-4" id="user-controls">
    <button id="user-profile-button" class="bg-white text-gray-700 font-semibold py-2 px-4 border border-gray-300 rounded-lg shadow-sm hover:bg-gray-50 transition-colors">
        Meu Perfil
    </button>
    <button id="sign-out-button" class="ml-2 bg-white text-red-600 font-semibold py-2 px-4 border border-gray-300 rounded-lg shadow-sm hover:bg-gray-50 transition-colors">
        Sair
    </button>
</div>

<div id="conteudo-protegido" style="display: none;">



    <div class="container mx-auto p-4 sm:p-6 lg:p-8 max-w-lg w-full">
        <div class="bg-white rounded-lg shadow-xl border border-gray-200 p-8">
            <h1 class="text-2xl font-bold text-gray-900 mb-4 text-center">Selecione um Relat√≥rio de Auditoria</h1>
            <p class="text-gray-600 mb-6 text-center">Navegue pelos relat√≥rios de verifica√ß√£o dispon√≠veis por data.</p>

            <div id="report-list" class="flex flex-col gap-3">
                <div class="text-center text-gray-500" id="loading-message">Carregando relat√≥rios dispon√≠veis...</div>
                <!-- Links dos relat√≥rios ser√£o inseridos aqui -->
            </div>

            <div class="mt-8 pt-6 border-t border-gray-200">
                <a href="gerador.html" class="block w-full py-3 px-4 bg-green-600 text-white font-bold rounded-lg shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-all duration-200 text-center">
                    Criar Novo Relat√≥rio
                </a>
            </div>
        </div>
    </div>

</div> <!-- ‚úÖ Fim do div de conte√∫do protegido -->


<script>
    // A l√≥gica para carregar os relat√≥rios continua a mesma
    document.addEventListener('DOMContentLoaded', async () => {
        const reportListDiv = document.getElementById('report-list');
        const loadingMessage = document.getElementById('loading-message');

        try {
            // Busca o arquivo reports.json na raiz do projeto
            const response = await fetch('reports.json');
            if (!response.ok) {
                throw new Error(`Erro ao carregar reports.json: ${response.statusText}`);
            }
            const reports = await response.json();

            loadingMessage.style.display = 'none'; // Esconde a mensagem de carregamento

            if (reports.length === 0) {
                reportListDiv.innerHTML = '<p class="text-center text-gray-500">Nenhum relat√≥rio dispon√≠vel no momento.</p>';
            } else {
                // Ordenar relat√≥rios por data (mais recente primeiro)
                reports.sort((a, b) => new Date(b.date.split('/').reverse().join('-')) - new Date(a.date.split('/').reverse().join('-')));

                for (const report of reports) {
                    try {
                        const reportPath = report.file;
                        const fileResponse = await fetch(reportPath, { method: 'HEAD' });

                        if (fileResponse.ok) {
                            const link = document.createElement('a');
                            link.href = reportPath;
                            link.className = 'block w-full py-3 px-4 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 transition-colors duration-200 text-center';
                            link.textContent = `Relat√≥rio de ${report.date}`;
                            reportListDiv.appendChild(link);
                        } else {
                            const span = document.createElement('span');
                            span.className = 'block w-full py-3 px-4 bg-gray-300 text-gray-600 font-semibold rounded-lg text-center cursor-not-allowed';
                            span.textContent = `Relat√≥rio de ${report.date} (Indispon√≠vel)`;
                            reportListDiv.appendChild(span);
                            console.warn(`Arquivo do relat√≥rio n√£o encontrado na raiz: ${report.file}`);
                        }
                    } catch (fileError) {
                        console.error(`Erro ao verificar o relat√≥rio ${report.file}:`, fileError);
                    }
                }
            }
        } catch (error) {
            console.error('Falha ao carregar a lista de relat√≥rios:', error);
            loadingMessage.style.display = 'none';
            reportListDiv.innerHTML = '<p class="text-center text-red-500">N√£o foi poss√≠vel carregar os relat√≥rios. Verifique o console para mais detalhes.</p>';
        }
    });
</script>
</body>
</html>


